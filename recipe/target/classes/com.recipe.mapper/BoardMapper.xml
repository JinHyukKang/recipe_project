<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.recipe.mapper.BoardMapper">

<!-- 레시피 글작성 -->
<insert id="boardWrite">
  INSERT INTO recipe (recipe_title, recipe_content, user_nickname, recipe_realname, recipe_filename, file_path, user_num) 
  VALUES (#{recipe_title},
  		  #{recipe_content},
  		  #{user_nickname},
  		  #{recipe_realname},
  		  #{recipe_filename},
  		  #{file_path},
  		  #{user_num}
  		  )
</insert>

<!-- 게시판 글 정보 모아오기(최신순) -->
<select id="findWriteAll" resultType="com.recipe.model.BoardVO">
	SELECT * FROM recipe
	ORDER BY insert_date DESC
</select>

<!-- 게시판 글 정보 모아오기(추천수순) -->
<select id="findWriteAllGood" resultType="com.recipe.model.BoardVO">
	SELECT * FROM recipe 
	ORDER BY good_count DESC
</select>

<!-- 게시판 글 정보 모아오기(조회수순) -->
<select id="findWriteAllView" resultType="com.recipe.model.BoardVO">
	SELECT * FROM recipe 
	ORDER BY view_count DESC
</select>

<!-- recipe_num을 받아 해당 게시판 글 데이터 불러오기 -->
<select id="viewWrite" resultType="com.recipe.model.BoardVO">
	SELECT * FROM recipe 
	WHERE recipe_num = #{recipe_num}
</select>

<!-- 조회수 증가 -->
<update id="viewUpdate">
 UPDATE recipe
 SET
     view_count = view_count + 1
 WHERE
     recipe_num = #{recipe_num}
 </update>

<!-- 조회수 감소 -->
<update id="viewBack">
 UPDATE recipe
 SET
     view_count = view_count - 1
 WHERE
     recipe_num = #{recipe_num}
 </update>

<!-- 추천수 증가 -->
<update id="goodUpdate">
 UPDATE recipe
 SET
     good_count = good_count + 1
 WHERE
     recipe_num = #{recipe_num}
</update>

<!-- 추천수 감소 -->
<update id="goodBack">
 UPDATE recipe
 SET
     good_count = good_count - 1
 WHERE
     recipe_num = #{recipe_num}
</update>

<!-- 댓글수 증가 -->
<update id="commentUpdate">
 UPDATE recipe
 SET
     comment_count = comment_count + 1
 WHERE
     recipe_num = #{recipe_num}
</update>

<!-- 댓글수 증가 -->
<update id="commentBack">
 UPDATE recipe
 SET
     comment_count = comment_count - 1
 WHERE
     recipe_num = #{recipe_num}
</update>

<!-- 다음글 정보 가져오기(최신순) -->
<select id="nextPageDate" resultType="com.recipe.model.BoardVO">
	SELECT *
	FROM recipe
	WHERE recipe_num =(SELECT prevDate
	FROM (
	SELECT *,
	LEAD(recipe_num) OVER (ORDER BY insert_date DESC) AS prevDate
	FROM recipe
	) AS subquery
	WHERE recipe_num = #{recipe_num}
	);						
</select>

<!-- 다음글 정보 가져오기(추천순) -->
<select id="nextPageGood" resultType="com.recipe.model.BoardVO">
	SELECT *
	FROM recipe
	WHERE recipe_num =(SELECT prevGood
	FROM (
	SELECT *,
	LEAD(recipe_num) OVER (ORDER BY good_count DESC) AS prevGood
	FROM recipe
	) AS subquery
	WHERE recipe_num = #{recipe_num}
	);
</select>

<!-- 다음글 정보 가져오기(조회순) -->
<select id="nextPageView" resultType="com.recipe.model.BoardVO">
	SELECT *
	FROM recipe
	WHERE recipe_num =(SELECT prevView
	FROM (
	SELECT *,
	LEAD(recipe_num) OVER (ORDER BY view_count DESC) AS prevView
	FROM recipe
	) AS subquery
	WHERE recipe_num = #{recipe_num}
	);
</select>

<!-- 이전글 정보 가져오기(최신순) -->
<select id="prevPageDate" resultType="com.recipe.model.BoardVO">
	SELECT *
	FROM recipe
	WHERE recipe_num =(SELECT prevDate
	FROM (
	SELECT *,
	LAG(recipe_num) OVER (ORDER BY insert_date DESC) AS prevDate
	FROM recipe
	) AS subquery
	WHERE recipe_num = #{recipe_num}
	);
</select>

<!-- 이전글 정보 가져오기(추천순) -->
<select id="prevPageGood" resultType="com.recipe.model.BoardVO">
	SELECT *
	FROM recipe
	WHERE recipe_num =(SELECT prevGood
	FROM (
	SELECT *,
	LAG(recipe_num) OVER (ORDER BY good_count DESC) AS prevGood
	FROM recipe
	) AS subquery
	WHERE recipe_num = #{recipe_num}
	);
</select>

<!-- 이전글 정보 가져오기(조회순) -->
<select id="prevPageView" resultType="com.recipe.model.BoardVO">
	SELECT *
	FROM recipe
	WHERE recipe_num =(SELECT prevView
	FROM (
	SELECT *,
	LAG(recipe_num) OVER (ORDER BY view_count DESC) AS prevView
	FROM recipe
	) AS subquery
	WHERE recipe_num = #{recipe_num}
	);
</select>

</mapper>